--- in_exec.rb	2017-01-19 19:53:26.089804477 +0000
+++ in_exec.rb.new	2017-01-19 19:58:47.950920711 +0000
@@ -131,6 +131,7 @@
 
     def run
       @parser.call(@io)
+      Process.waitpid(@io.pid) if !@io.nil?
     end
 
     def run_periodic
@@ -139,11 +140,12 @@
         begin
           io = IO.popen(@command, "r")
           @parser.call(io)
-          Process.waitpid(io.pid)
-          sleep @run_interval
         rescue
           log.error "exec failed to run or shutdown child process", error: $!.to_s, error_class: $!.class.to_s
           log.warn_backtrace $!.backtrace
+        ensure
+          Process.waitpid(io.pid) if !io.nil?
+          sleep @run_interval
         end
       end
     end
